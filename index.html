<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flou Dashboard</title>

<style>
    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background: #83C7FF;
        overflow-x: hidden;
        color: #06345F;
    }

    /* HEADER */
    header {
        width: 100%;
        background: #FFFFFF;
        padding: 25px 40px;
        display: flex;
        align-items: center;
        gap: 20px;
        position: relative;
    }

    header img {
        width: 70px;
        height: auto;
    }

    header h1 {
        font-size: 38px;
        font-weight: 800;
        color: #06345F;
    }

    /* WAVE SVG */
    #wave {
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 100%;
        height: 120px;
    }

    /* CATEGORY PANEL */
    .category-panel {
        position: absolute;
        top: 130px;
        right: 50px;
        background: #0C4BA5;
        padding: 15px 18px;
        border-radius: 12px;
        color: white;
        width: 150px;
        box-shadow: 0 6px 14px rgba(0,0,0,0.25);
    }

    .category-panel h3 {
        margin: 0 0 10px;
        font-size: 17px;
        font-weight: 700;
    }

    .category-panel div {
        background: #1F7AFF;
        padding: 8px;
        margin: 4px 0;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: 0.25s;
        text-align: center;
    }

    .category-panel div:hover {
        background: #5CB8FF;
    }

    /* MAIN CONTENT */
    .main {
        margin-top: 140px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .graph-title {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 20px;
        color: white;
        text-shadow: 0 2px 4px rgba(0,0,0,0.25);
    }

    /* GRAPH CARD */
    .graph-wrapper {
        background: white;
        padding: 35px;
        border-radius: 30px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.20);
        width: 900px;
        max-width: 90%;
        position: relative;
        border: 6px solid #0B51A6;
    }

    canvas {
        width: 100% !important;
        height: 360px !important;
    }

    /* SLIDER BUTTONS */
    .slider-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: #0A59C8;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: 0 6px 14px rgba(0,0,0,0.25);
    }

    .slider-btn:hover {
        background: #0D6FE0;
    }

    #prevBtn {
        left: -100px;
    }
    #nextBtn {
        right: -100px;
    }

    .slider-btn span {
        font-size: 30px;
        color: white;
        pointer-events: none;
    }
</style>

</head>
<body>

<header>
    <img src="flouLogo.png">
    <h1>Dashboard</h1>
    <svg id="wave"></svg>
</header>

<!-- PANEL CATEGORÍAS -->
<div class="category-panel">
    <h3>Categories</h3>
    <div data-cat="all">All</div>
    <div data-cat="Suscripción">Subscriptions</div>
    <div data-cat="Servicios">Services</div>
    <div data-cat="Add-on">Add-ons</div>
</div>

<div class="main">
    <div class="graph-title" id="graphTitle">Ventas Mensuales</div>

    <div class="graph-wrapper">
        <div id="prevBtn" class="slider-btn"><span>&lt;</span></div>
        <canvas id="chartArea"></canvas>
        <div id="nextBtn" class="slider-btn"><span>&gt;</span></div>
    </div>
</div>


<!-- LIBRERÍAS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/wavify/wavify.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.10.4/dist/gsap.min.js"></script>


<script>
/* --------------------------- WAVE FIX ---------------------------- */
wavify(document.querySelector('#wave'), {
    height: 100,
    bones: 6,
    amplitude: 55,
    color: "#5EB7FF",
    speed: 0.20
});


/* --------------------------- LOAD CSV ---------------------------- */
let rawData = [];
let currentIndex = 0;
let charts = [];

const graphTitles = [
    "Ventas Mensuales",
    "Ventas por Categoría",
    "Ventas por Producto"
];

fetch("flouness_ventas_anuales.csv")
    .then(r => r.text())
    .then(t => {
        rawData = parseCSV(t);
        createChart(0);
    });


function parseCSV(csv) {
    const lines = csv.trim().split("\n").slice(1);
    return lines.map(line => {
        const [Mes, Producto, Ventas] = line.split(",");
        return { Mes, Producto, Ventas: Number(Ventas) };
    });
}


/* --------------------------- GRAPH SLIDER ---------------------------- */
document.getElementById("nextBtn").onclick = () => {
    currentIndex = (currentIndex + 1) % 3;
    createChart(currentIndex);
};

document.getElementById("prevBtn").onclick = () => {
    currentIndex = (currentIndex - 1 + 3) % 3;
    createChart(currentIndex);
};


/* --------------------------- CHART ENGINE ---------------------------- */
function createChart(index) {
    if (charts[0]) charts[0].destroy();

    document.getElementById("graphTitle").innerText = graphTitles[index];

    const ctx = document.getElementById("chartArea");

    if (index === 0) drawMonthly(ctx);
    if (index === 1) drawCategory(ctx);
    if (index === 2) drawProducts(ctx);
}

function drawMonthly(ctx) {
    const monthly = {};

    rawData.forEach(r => monthly[r.Mes] = (monthly[r.Mes] || 0) + r.Ventas);

    charts[0] = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Object.keys(monthly),
            datasets: [{
                label: "Ventas",
                data: Object.values(monthly),
                tension: 0.45,
                borderColor: "#0A59C8",
                backgroundColor: "rgba(85,180,255,0.28)",
                fill: true
            }]
        }
    });
}

function drawCategory(ctx) {
    const totals = {};
    rawData.forEach(r => {
        const cat = categorize(r.Producto);
        totals[cat] = (totals[cat] || 0) + r.Ventas;
    });

    charts[0] = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(totals),
            datasets: [{
                label: "Ventas",
                data: Object.values(totals),
                backgroundColor: "#0A59C8"
            }]
        }
    });
}

function drawProducts(ctx) {
    const totals = {};
    rawData.forEach(r => totals[r.Producto] = (totals[r.Producto] || 0) + r.Ventas);

    charts[0] = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: Object.keys(totals),
            datasets: [{
                data: Object.values(totals),
                backgroundColor: [
                    "#0A59C8","#1D73E5","#4AA3FF","#7BC8FF",
                    "#0F4DA1","#63B5FF","#1C6ED3","#A9DDFF"
                ]
            }]
        }
    });
}


/* --------------------------- CATEGORY MAP ---------------------------- */
function categorize(product) {
    if (product.includes("Basic") || product.includes("Team") || product.includes("Business") || product.includes("Enterprise"))
        return "Suscripción";
    if (product.includes("Onboarding") || product.includes("Consultoría") || product.includes("Branding"))
        return "Servicios";
    return "Add-on";
}
</script>

</body>
</html>

