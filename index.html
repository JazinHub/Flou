<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Flou Dashboard</title>

<style>
    body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background: #83C7FF;
        overflow-x: hidden;
        color: #06345F;
    }

    /* HEADER */
    header {
        width: 100%;
        background: white;
        padding: 22px 40px;
        display: flex;
        align-items: center;
        gap: 18px;
        position: relative;
        z-index: 3;
        box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }

    header img {
        width: 65px;
        height: auto;
    }

    header h1 {
        font-size: 38px;
        font-weight: 800;
        margin: 0;
        color: #06345F;
    }

    /* WAVES */
    .wave-container {
        width: 100%;
        height: 140px;
        overflow: hidden;
        position: relative;
        top: -2px;
        z-index: 2;
    }

    svg {
        display: block;
        width: 100%;
        height: 120%;
    }

    /* CATEGORY PANEL */
    .category-panel {
        margin-top: 20px;
        margin-right: 50px;
        background: #0C4BA5;
        padding: 16px;
        border-radius: 15px;
        color: white;
        width: 165px;
        box-shadow: 0 6px 14px rgba(0,0,0,0.25);
        position: absolute;
        right: 40px;
        top: 145px;
        animation: fadeIn 0.8s ease-out;
    }

    .category-panel h3 {
        margin: 0 0 10px;
        font-size: 17px;
        font-weight: 700;
    }

    .category-panel div {
        background: #1F7AFF;
        padding: 8px;
        margin: 4px 0;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: 0.25s;
        text-align: center;
    }

    .category-panel div:hover {
        background: #5CB8FF;
        transform: scale(1.05);
    }

    /* MAIN LAYOUT */
    .main {
        margin-top: 130px;
        display: flex;
        flex-direction: column;
        align-items: center;
        animation: fadeIn 1s ease-out;
    }

    .graph-title {
        font-size: 30px;
        font-weight: 700;
        margin-bottom: 20px;
        color: white;
        text-shadow: 0 2px 4px rgba(0,0,0,0.25);
        animation: slideDown 0.6s ease-out;
    }

    /* CHART CARD */
    .graph-wrapper {
        background: white;
        padding: 35px;
        border-radius: 30px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.20);
        width: 900px;
        max-width: 90%;
        min-height: 480px;
        position: relative;
        border: 6px solid #0B51A6;
        animation: fadeUp 0.8s ease-out;
        display: flex;
        align-items: center;
    }

    canvas {
        width: 100% !important;
        height: 400px !important;
    }

    /* BUTTONS */
    .slider-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: #0A59C8;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: 0.25s;
        box-shadow: 0 6px 14px rgba(0,0,0,0.25);
    }
    .slider-btn:hover {
        transform: translateY(-50%) scale(1.1);
        background: #0D6FE0;
    }
    #prevBtn { left: -85px; }
    #nextBtn { right: -85px; }

    .slider-btn span {
        font-size: 30px;
        color: white;
        pointer-events: none;
    }

    .bottom-pad { height: 120px; }

    /* ANIMATIONS */
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    @keyframes fadeUp { from {opacity:0; transform:translateY(30px);} to {opacity:1; transform:translateY(0);} }
    @keyframes slideDown { from {opacity:0; transform:translateY(-25px);} to {opacity:1; transform:translateY(0);} }
</style>
</head>

<body>

<header>
    <img src="./flouLogo.png" alt="Flou Logo">
    <h1>Dashboard</h1>
</header>

<!-- WAVES -->
<div class="wave-container">
<svg viewBox="0 0 1440 320"><path fill="#83C7FF" d="M0,32L60,32C120,32,240,32,360,48C480,64,600,96,720,133.3C840,171,960,213,1080,202.7C1200,192,1320,128,1380,96L1440,64L1440,0L0,0Z"></path></svg>
</div>

<!-- CATEGORY FILTER -->
<div class="category-panel">
    <h3>Categorías</h3>
    <div onclick="setFilter('all')">All</div>
    <div onclick="setFilter('Suscripción')">Subscriptions</div>
    <div onclick="setFilter('Servicios')">Services</div>
    <div onclick="setFilter('Add-on')">Add-ons</div>
</div>

<div class="main">
    <div class="graph-title" id="graphTitle">Ventas por Categoría</div>

    <div class="graph-wrapper">
        <div id="prevBtn" class="slider-btn"><span>&lt;</span></div>
        <canvas id="chart"></canvas>
        <div id="nextBtn" class="slider-btn"><span>&gt;</span></div>
    </div>
</div>

<div class="bottom-pad"></div>

<!-- LIBS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ------------ DATA & CATEGORY MAP ------------ */
const categoryMap = {
    "Flouness Basic": "Suscripción",
    "Flouness Team": "Suscripción",
    "Flouness Business": "Suscripción",
    "Flouness Enterprise": "Suscripción",
    "Flouness Onboarding Pack": "Servicios",
    "Flouness Data Insights": "Add-on",
    "Flouness Storage Pro": "Add-on",
    "Flouness Branding White Label": "Servicios",
    "Flouness Integrations Hub": "Add-on",
    "Consultoría Flujo Perfecto": "Servicios"
};

let rawData = [];
let currentGraph = 0;
let chart;
let filterSelected = "all";

/* ------------ LOAD CSV ------------ */
fetch('./flouness_ventas_anuales.csv')
.then(res=>res.text())
.then(text=>{
    rawData=parseCSV(text);
    updateChart();
});

/* ------------ PARSE CSV ------------ */
function parseCSV(csv){
    const lines = csv.trim().split("\n").slice(1);
    return lines.map(l=>{
        const [Mes,Producto,Ventas]=l.split(",");
        return {Mes,Producto,Ventas:Number(Ventas),Categoria:categoryMap[Producto]};
    });
}

/* ------------ FILTER ------------ */
function setFilter(type){
    filterSelected = type;
    updateChart();
}

/* ------------ GRAPH DATA ----------- */
function getFiltered(){
    return filterSelected==="all"?rawData:rawData.filter(r=>r.Categoria===filterSelected);
}

/* ------------ CHART DRAWING ---------- */
function updateChart(){
    const data = getFiltered();
    const labels={};  
    data.forEach(r => labels[r.Categoria] = (labels[r.Categoria]||0)+r.Ventas);

    const ctx = document.getElementById("chart");
    if(chart) chart.destroy();

    chart=new Chart(ctx,{
        type:'bar',
        data:{
            labels:Object.keys(labels),
            datasets:[{
                label:'Ventas',
                data:Object.values(labels),
                backgroundColor:"#0A59C8"
            }]
        }
    });

    document.getElementById("graphTitle").innerText="Ventas por Categoría";
}

/* -------- BUTTONS (future graphs) -----*/
document.getElementById("prevBtn").onclick=()=>{};
document.getElementById("nextBtn").onclick=()=>{};
</script>

</body>
</html>
